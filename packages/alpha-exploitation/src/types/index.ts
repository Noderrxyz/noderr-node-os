/**
 * Alpha Exploitation Types - Elite 0.01% Trading Infrastructure
 * 
 * Defines types for legitimate alpha generation, advanced market analytics,
 * fair market participation, and defensive trading capabilities.
 */

import { BigNumber } from 'bignumber.js';

// Core Types
export * from './liquidity';
export * from './arbitrage';
export * from './microstructure';
export * from './defense';
export * from './analytics';

// Alpha Opportunity Types
export interface AlphaOpportunity {
  id: string;
  type: AlphaType;
  source: AlphaSource;
  confidence: number; // 0-1
  expectedReturn: number; // basis points
  riskScore: number; // 0-1
  timeHorizon: number; // milliseconds
  capital: BigNumber;
  priority: AlphaPriority;
  metadata: Record<string, any>;
}

export enum AlphaType {
  ARBITRAGE = 'ARBITRAGE',
  LIQUIDITY_PROVISION = 'LIQUIDITY_PROVISION',
  STATISTICAL_ARB = 'STATISTICAL_ARB',
  MARKET_MAKING = 'MARKET_MAKING',
  VOLATILITY_CAPTURE = 'VOLATILITY_CAPTURE',
  MEAN_REVERSION = 'MEAN_REVERSION',
  MOMENTUM = 'MOMENTUM',
  MICROSTRUCTURE = 'MICROSTRUCTURE',
  CROSS_VENUE = 'CROSS_VENUE',
  FUNDING_RATE = 'FUNDING_RATE'
}

export enum AlphaSource {
  ORDERBOOK_IMBALANCE = 'ORDERBOOK_IMBALANCE',
  CROSS_EXCHANGE = 'CROSS_EXCHANGE',
  DEX_CEX_SPREAD = 'DEX_CEX_SPREAD',
  FUNDING_DIVERGENCE = 'FUNDING_DIVERGENCE',
  VOLATILITY_SMILE = 'VOLATILITY_SMILE',
  LIQUIDATION_CASCADE = 'LIQUIDATION_CASCADE',
  MICROSTRUCTURE_SIGNAL = 'MICROSTRUCTURE_SIGNAL',
  AI_PREDICTION = 'AI_PREDICTION',
  PATTERN_RECOGNITION = 'PATTERN_RECOGNITION',
  WHALE_MOVEMENT = 'WHALE_MOVEMENT'
}

export enum AlphaPriority {
  CRITICAL = 0,    // Must execute immediately
  HIGH = 1,        // Execute within 100ms
  NORMAL = 2,      // Execute within 1s
  LOW = 3          // Execute when optimal
}

// Market Microstructure
export interface MarketMicrostructure {
  venue: string;
  symbol: string;
  timestamp: number;
  spread: {
    absolute: number;
    relative: number; // basis points
    trend: 'widening' | 'narrowing' | 'stable';
  };
  depth: {
    bidDepth: OrderDepth;
    askDepth: OrderDepth;
    imbalance: number; // -1 to 1
  };
  orderFlow: {
    buyVolume: BigNumber;
    sellVolume: BigNumber;
    netFlow: BigNumber;
    vwap: number;
    toxicity: number; // 0-1
  };
  liquidity: {
    available: BigNumber;
    resilience: number; // 0-1
    replenishmentRate: number; // per second
  };
}

export interface OrderDepth {
  levels: PriceLevel[];
  totalVolume: BigNumber;
  weightedPrice: number;
  concentration: number; // Herfindahl index
}

export interface PriceLevel {
  price: number;
  quantity: BigNumber;
  orders: number;
  cumulative: BigNumber;
}

// Execution Configuration
export interface AlphaExecutionConfig {
  mode: ExecutionMode;
  urgency: ExecutionUrgency;
  slippageTolerance: number; // basis points
  maxImpact: number; // basis points
  timeLimit: number; // milliseconds
  smartRouting: boolean;
  darkPoolAccess: boolean;
  mevProtection: MEVProtectionLevel;
  splitStrategy: SplitStrategy;
}

export enum ExecutionMode {
  PASSIVE = 'PASSIVE',        // Maker only
  NORMAL = 'NORMAL',          // Mixed maker/taker
  AGGRESSIVE = 'AGGRESSIVE',   // Taker focused
  STEALTH = 'STEALTH',        // Hidden/iceberg
  ADAPTIVE = 'ADAPTIVE'       // AI-optimized
}

export enum ExecutionUrgency {
  IMMEDIATE = 'IMMEDIATE',    // <10ms
  URGENT = 'URGENT',          // <100ms
  NORMAL = 'NORMAL',          // <1s
  PATIENT = 'PATIENT'         // Best execution
}

export enum MEVProtectionLevel {
  NONE = 'NONE',
  BASIC = 'BASIC',            // Time randomization
  ENHANCED = 'ENHANCED',      // Private mempool
  MAXIMUM = 'MAXIMUM'         // Full obfuscation
}

export interface SplitStrategy {
  method: 'FIXED' | 'DYNAMIC' | 'ADAPTIVE';
  minSize: BigNumber;
  maxSize: BigNumber;
  venues: string[];
  timeRandomization: boolean;
}

// Fair Market Participation
export interface FairLiquidation {
  protocolId: string;
  positionId: string;
  collateral: BigNumber;
  debt: BigNumber;
  liquidationPrice: number;
  currentPrice: number;
  healthFactor: number;
  incentive: number; // basis points
  gasEstimate: BigNumber;
  profitability: number; // after costs
  fairnessScore: number; // 0-1, based on protocol rules
}

// Analytics Types
export interface MarketAnalytics {
  venue: string;
  symbol: string;
  period: number; // milliseconds
  metrics: {
    volatility: VolatilityMetrics;
    liquidity: LiquidityMetrics;
    momentum: MomentumMetrics;
    microstructure: MicrostructureMetrics;
  };
  signals: TradingSignal[];
  regime: MarketRegime;
}

export interface VolatilityMetrics {
  realized: number;
  implied: number;
  garch: number;
  percentile: number;
  term: 'increasing' | 'decreasing' | 'stable';
}

export interface LiquidityMetrics {
  depth: BigNumber;
  resilience: number;
  turnover: BigNumber;
  concentration: number;
  fragmentation: number;
}

export interface MomentumMetrics {
  price: number;
  volume: number;
  rsi: number;
  macd: {
    value: number;
    signal: number;
    histogram: number;
  };
}

export interface MicrostructureMetrics {
  spreadCost: number;
  impactCost: number;
  timingCost: number;
  informationRatio: number;
  adverseSelection: number;
}

export interface TradingSignal {
  type: SignalType;
  strength: number; // -1 to 1
  confidence: number; // 0 to 1
  timeframe: number;
  metadata: Record<string, any>;
}

export enum SignalType {
  BUY = 'BUY',
  SELL = 'SELL',
  NEUTRAL = 'NEUTRAL',
  VOLATILITY_EXPANSION = 'VOLATILITY_EXPANSION',
  LIQUIDITY_CRISIS = 'LIQUIDITY_CRISIS',
  REGIME_CHANGE = 'REGIME_CHANGE'
}

export enum MarketRegime {
  NORMAL = 'normal',
  HIGH_VOLATILITY = 'high_volatility',
  LOW_LIQUIDITY = 'low_liquidity',
  TRENDING = 'trending',
  RISK_OFF = 'risk_off'
}

// Performance Metrics
export interface AlphaPerformance {
  opportunitiesIdentified: number;
  opportunitiesExecuted: number;
  successRate: number;
  totalPnL: BigNumber;
  sharpeRatio: number;
  maxDrawdown: number;
  hitRate: number;
  profitFactor: number;
  averageReturn: number; // basis points
  returnVolatility: number;
  informationRatio: number;
  calmarRatio: number;
  executionMetrics: {
    avgSlippage: number;
    avgLatency: number;
    fillRate: number;
    costSavings: number;
  };
}

// Configuration
export interface AlphaExploitationConfig {
  enabled: boolean;
  mode: 'defensive' | 'balanced' | 'aggressive';
  strategies: AlphaType[];
  venues: string[];
  minConfidence: number;
  minExpectedReturn: number; // basis points
  maxRiskScore: number;
  capitalAllocation: {
    maxPerOpportunity: BigNumber;
    maxTotal: BigNumber;
    reserveRatio: number;
  };
  execution: AlphaExecutionConfig;
  analytics: {
    updateFrequency: number; // milliseconds
    lookbackPeriod: number; // milliseconds
    mlModelsEnabled: boolean;
  };
  defense: {
    antiManipulation: boolean;
    adversarialDetection: boolean;
    emergencyStop: boolean;
  };
} 