/**
 * Analytics Types - Advanced market analytics and insights
 */

import { BigNumber } from 'bignumber.js';

export interface MarketInsight {
  type: InsightType;
  priority: InsightPriority;
  confidence: number;
  message: string;
  data: Record<string, any>;
  timestamp: number;
}

export enum InsightType {
  REGIME_CHANGE = 'regime_change',
  UNUSUAL_ACTIVITY = 'unusual_activity',
  PERFORMANCE_ALERT = 'performance_alert',
  OPPORTUNITY_CLUSTER = 'opportunity_cluster',
  RISK_WARNING = 'risk_warning',
  EFFICIENCY_GAIN = 'efficiency_gain'
}

export enum InsightPriority {
  LOW = 'low',
  MEDIUM = 'medium',
  HIGH = 'high',
  CRITICAL = 'critical'
}

export enum MarketRegime {
  NORMAL = 'normal',
  HIGH_VOLATILITY = 'high_volatility',
  LOW_LIQUIDITY = 'low_liquidity',
  TRENDING = 'trending',
  RISK_OFF = 'risk_off'
}

export interface VolumeProfile {
  symbol: string;
  timestamp: number;
  priceLevel: number;
  buyVolume: BigNumber;
  sellVolume: BigNumber;
  totalVolume: BigNumber;
  vwap: number;
  volumeDistribution: {
    retail: number;
    institutional: number;
    algorithmic: number;
  };
}

export interface FlowAnalysis {
  symbol: string;
  timestamp: number;
  netFlow: BigNumber;
  buyFlow: BigNumber;
  sellFlow: BigNumber;
  largeOrderFlow: BigNumber;
  smartMoneyFlow: BigNumber;
  sentiment: 'bullish' | 'bearish' | 'neutral';
}

export interface PerformanceMetrics {
  totalOpportunities: number;
  successfulTrades: number;
  totalPnL: BigNumber;
  sharpeRatio: number;
  maxDrawdown: number;
  winRate: number;
  avgSlippage: number;
  avgLatency: number;
  uptime: number;
  startTime: number;
}

export interface ModelPerformance {
  modelId: string;
  metrics: {
    mse: number;
    mae: number;
    sharpe: number;
    hitRate: number;
    maxDrawdown: number;
  };
  sampleSize: number;
  lastUpdate: number;
}

export interface RegimeAnalysis {
  currentRegime: MarketRegime;
  confidence: number;
  indicators: {
    volatility: number;
    liquidity: number;
    momentum: number;
    correlation: number;
  };
  transitionProbabilities: Record<MarketRegime, number>;
  expectedDuration: number; // milliseconds
}

export interface CorrelationMatrix {
  symbols: string[];
  matrix: number[][];
  timestamp: number;
  period: string; // e.g., '5m', '1h', '1d'
}

export interface VolumeProfile {
  venue: string;
  symbol: string;
  period: number; // milliseconds
  profile: {
    totalVolume: BigNumber;
    buyVolume: BigNumber;
    sellVolume: BigNumber;
    avgTradeSize: BigNumber;
    largeTradeRatio: number; // 0-1
    volumeVelocity: number; // rate of change
  };
  distribution: {
    byPrice: PriceVolume[];
    byTime: TimeVolume[];
    bySize: SizeDistribution;
  };
  analytics: {
    vwap: number;
    volumeWeightedSpread: number;
    participationRate: number;
    volumeConcentration: number; // Gini coefficient
  };
}

export interface PriceVolume {
  price: number;
  volume: BigNumber;
  buyVolume: BigNumber;
  sellVolume: BigNumber;
  trades: number;
}

export interface TimeVolume {
  timestamp: number;
  volume: BigNumber;
  price: number;
  trades: number;
}

export interface SizeDistribution {
  buckets: {
    micro: number; // <$1k
    small: number; // $1k-$10k
    medium: number; // $10k-$100k
    large: number; // $100k-$1M
    whale: number; // >$1M
  };
  percentiles: {
    p25: BigNumber;
    p50: BigNumber;
    p75: BigNumber;
    p90: BigNumber;
    p99: BigNumber;
  };
}

export interface CorrelationMatrix {
  symbols: string[];
  timeframe: number; // milliseconds
  matrix: number[][]; // correlation coefficients
  stability: number; // 0-1, how stable correlations are
  breakpoints: CorrelationBreak[];
  clusters: SymbolCluster[];
}

export interface CorrelationBreak {
  symbol1: string;
  symbol2: string;
  previousCorrelation: number;
  currentCorrelation: number;
  changeRate: number;
  significance: number; // statistical significance
  timestamp: number;
}

export interface SymbolCluster {
  symbols: string[];
  centroid: string;
  cohesion: number; // 0-1
  separation: number; // 0-1
  behavior: 'trending' | 'mean_reverting' | 'volatile' | 'stable';
}

export interface FlowAnalytics {
  venue: string;
  symbol: string;
  period: number;
  flows: {
    net: BigNumber;
    cumulative: BigNumber;
    smart: BigNumber; // identified smart money
    retail: BigNumber;
    institutional: BigNumber;
  };
  patterns: {
    accumulation: boolean;
    distribution: boolean;
    rotation: boolean;
    capitulation: boolean;
  };
  strength: {
    buying: number; // 0-1
    selling: number; // 0-1
    neutral: number; // 0-1
  };
}

export interface SentimentAnalytics {
  symbol: string;
  timestamp: number;
  sources: {
    social: SentimentScore;
    news: SentimentScore;
    onChain: SentimentScore;
    derivatives: SentimentScore;
  };
  aggregate: {
    score: number; // -1 to 1
    confidence: number; // 0-1
    momentum: number; // rate of change
    divergence: number; // vs price action
  };
  events: SentimentEvent[];
}

export interface SentimentScore {
  score: number; // -1 to 1
  volume: number; // data points
  quality: number; // 0-1
  sources: string[];
}

export interface SentimentEvent {
  type: 'spike' | 'reversal' | 'divergence' | 'convergence';
  magnitude: number;
  timestamp: number;
  sources: string[];
} 